# AstrBot GIF转视频插件 v2.0.6 发布公告

## 🎉 版本更新

AstrBot GIF转视频插件 v2.0.6 现已发布！本次更新主要包含代码质量改进和稳定性提升。

## 📋 更新内容

### 🔧 代码质量改进

1. **数据持久化优化**
   - 使用框架提供的 `StarTools.get_data_dir()` 替代硬编码的临时目录
   - 确保插件数据存储在框架提供的专属目录中，避免与其他插件冲突
   - 提高了数据存储的规范性和可靠性

2. **资源管理增强**
   - 在 `handle_gif_message` 方法中添加了 `try...finally` 块
   - 新增了 `_cleanup_request_temp_files` 方法，确保每次请求后立即清理临时文件
   - 避免了程序异常崩溃时临时文件残留的问题

3. **代码质量修复**
   - 将 `terminate` 方法从异步改为同步，因为内部没有执行任何 await 操作
   - 消除了不必要的协程对象，提高了代码清晰度

4. **可维护性提升**
   - 重构了获取provider ID的方法，使用框架提供的稳定API
   - 减少了对 `provider_manager` 内部实现的直接依赖
   - 增加了更多的错误处理和日志记录

5. **测试代码优化**
   - 移除了 `tests/test_plugin.py` 中重复的 `TestGifConversion` 类
   - 将所有GIF转换相关测试统一到 `tests/test_conversion.py` 文件中
   - 修正了 `test_terminate` 测试用例，使其与同步方法保持一致

## 🚀 改进亮点

- **更好的稳定性**: 通过改进资源管理和错误处理，插件在异常情况下更加稳定
- **更强的兼容性**: 使用框架提供的标准API，提高了与未来框架版本的兼容性
- **更清晰的代码**: 消除了重复代码和异步方法的不必要使用，提高了代码可读性
- **更规范的存储**: 遵循框架的数据持久化规范，确保数据安全存储

## 📦 安装和更新

### 更新现有安装
如果您已经安装了之前的版本，可以通过以下方式更新：

1. 在AstrBot WebUI的插件管理页面找到此插件
2. 点击"管理" → "重载插件"
3. 或者重新克隆/下载最新版本的插件

### 全新安装
1. 下载最新版本的插件到AstrBot的plugins目录
2. 确保已安装所有依赖（FFmpeg和Python包）
3. 重启AstrBot或重载插件

## 🔗 相关链接

- GitHub仓库: https://github.com/piexian/astrbot_plugin_gif_to_video
- 插件文档: README.md
- 更新日志: CHANGELOG.md

## 🙏 致谢

感谢所有用户的反馈和建议，特别是代码审查提供的宝贵意见，这些改进让插件变得更加稳定和可靠！

---

**发布日期**: 2025-10-19  
**版本**: v2.0.6  
**兼容性**: AstrBot v4.0.0+