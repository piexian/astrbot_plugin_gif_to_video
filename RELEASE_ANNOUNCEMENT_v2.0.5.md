# AstrBot GIF转视频插件 v2.0.5 发布公告

## 🎉 版本更新

我们很高兴地宣布 AstrBot GIF转视频插件 v2.0.5 已发布！

## 🐛 重要问题修复

### 临时文件生命周期管理问题
- **修复了** `FileNotFoundError: [Errno 2] No such file or directory` 错误
- **解决了** 因临时目录过早删除导致的文件访问失败问题
- **优化了** 临时文件管理，使用持久化临时目录

## 🚀 新功能

### 智能缓存系统
- **实现了** 基于MD5哈希的缓存系统
- **支持** 相同GIF文件只需转换一次，大幅提高响应速度
- **缓存时长** 24小时，平衡性能与存储空间
- **自动清理** 过期缓存，避免磁盘空间浪费

### 缓存机制特性
- **智能识别** 基于GIF源URL或文件路径生成唯一缓存键
- **快速响应** 缓存命中时直接返回转换结果，无需重新处理
- **自动管理** 定期清理超过24小时的缓存文件
- **线程安全** 支持并发请求，确保缓存操作的安全性

## 🔧 技术改进

### 文件管理优化
- **持久化临时目录** 不再使用 `with tempfile.TemporaryDirectory()` 避免过早删除
- **生命周期跟踪** 实现临时文件注册和清理机制
- **缓存目录管理** 在系统临时目录创建专用缓存文件夹

### 性能提升
- **减少重复转换** 相同GIF文件在24小时内只需转换一次
- **快速响应** 缓存命中时响应时间从数秒降至毫秒级
- **资源优化** 自动清理过期缓存，控制磁盘空间使用

## 📦 更新建议

如果您遇到了以下错误，请立即更新到此版本：
```
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmpj1ktcv8n/output.mp4'
```

## 🚀 如何更新

1. 通过 AstrBot 插件市场搜索 `gif转视频插件` 并更新到最新版本
2. 或者手动拉取最新代码：
   ```bash
   cd /AstrBot/data/plugins/astrbot_plugin_gif_to_video
   git pull origin main
   ```

## 💡 使用提示

### 缓存机制说明
- 缓存文件保存在系统临时目录的 `astrbot_gif_cache` 文件夹中
- 相同的GIF文件（URL或路径）在24小时内会使用缓存
- 插件会自动清理超过24小时的缓存文件
- 缓存命中时会在日志中显示 "使用缓存文件" 提示

### 性能优势
- **首次转换**：正常的转换时间（通常几秒）
- **缓存命中**：几乎瞬时响应（毫秒级）
- **重复请求**：大幅减少服务器负载和响应时间

## 🙏 致谢

感谢用户反馈的临时文件访问问题，这帮助我们快速定位并修复了这个关键问题。

## 📞 支持

如果您在使用过程中遇到任何问题，请通过以下方式联系我们：
- 提交 Issue: https://github.com/piexian/astrbot_plugin_gif_to_video/issues
- 查看 README.md 中的故障排除指南

---

**发布日期**: 2025-10-19  
**版本**: v2.0.5  
**兼容性**: AstrBot v4.3.5+, MoviePy 1.0.3-2.2.1+